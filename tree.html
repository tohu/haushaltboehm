<!doctype html>

<html lang="de">
<head>
  <meta charset="utf-8">
  <title>#haushaltboehm</title>
  <meta name="description" content="Definiere deinen Bundeshaushalt auf #myhaushalt!">
  <meta name="author" content="myhaushalt">
  <link rel="stylesheet" href="css/styles.css?v=1.0">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.2.1/themes/default/style.min.css" />
</head>

<body>

  <div style="font-size: 8em;width:40%; float: left; text-align: center; background: pink;">BUND</div>
  <div style="width:20%; float: left; text-align: center;">
    <img src="img/ei.jpg" style="height: 8em;margin-top: 7px;"></img>
  </div>
  <div style="font-size: 8em;width:40%; float: left; text-align: center; background: aquamarine; margin-bottom: 10px;">BÖHM</div>

  <div id="controls" style="width: 98%; display: inline-block; background: cornflowerblue; margin: 0px 1%;">
    <button id="export" style="width:9%; margin-top: 3px; margin-bottom: 3px; margin-left: 40%; background:aquamarine; color:black; float: left; border: 4px solid pink; font-weight:bold;">EXPORT</button>
    <button id="import" style="width:9%; margin-top: 3px; margin-bottom: 3px; margin-right: 40%; background:pink; color:black; float: right; border: 4px solid aquamarine; font-weight:bold;">IMPORT</button>
    <input type="file" id="jsonfileinput" style="display:none;"></input>
  </div>

  <div id="haushaltsvorgespraeche" style="text-align:center; width: 98%; display: inline-block; font-size:2em; background: red; margin: 10px 1%;">HaushaltsVORgepräche.</div>

  <div id="tree-container" style="margin-left: 1%; width: 47%; margin-bottom: 100px; background: rgb(200,190,50); display: inline-block; float: left;">
    <!-- <div id="tree" style="margin-top: 50px;"></div> -->
  </div>
  <div id="tree-container2" style="margin-right: 1%; width: 47%; margin-bottom: 100px; background: rgb(200,190,50); display: inline-block; float:right;">
    <!-- <div id="tree" style="margin-top: 50px;"></div> -->
  </div>





  <!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script> -->
  <script src="https://d3js.org/d3.v3.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.2.1/jstree.min.js"></script>


  <script>

  $(document).ready(function() {

  setInterval(function() {
    var r = Math.floor(Math.random() * 255);
    var g = Math.floor(Math.random() * 255);
    var b = Math.floor(Math.random() * 255);
    $('#haushaltsvorgespraeche').css("background", "rgb(" + r + ", " + g + ", " + b + ")");
  }, 30000);

  String.prototype.replaceAll = function(search, replacement) {
    var target = this;
    return target.replace(new RegExp(search, 'g'), replacement);
  };

    var saveData = (function () {
      var a = document.createElement("a");
      document.body.appendChild(a);
      a.style = "display: none";
      return function (data, fileName) {
          var json = JSON.stringify(data),
              blob = new Blob([json], {type: "octet/stream"}),
              url = window.URL.createObjectURL(blob);
          a.href = url;
          a.download = fileName;
          a.click();
          window.URL.revokeObjectURL(url);
      };
    }());

    function make_tree(data, parent) {
      if(!parent)
        parent = "#tree-container";
      var $div = $('<div>').addClass('tree');
      $div.jstree(
        { 'core' : {
            'data' : [ data],
            "check_callback" : true
        },
        "plugins" : [
          "dnd", "contextmenu"
        ]}
      );

      $(parent).empty();
      $(parent).append($div);
    }
    $.getJSON('data/haushalt_2016tree.json', function(data) {
      make_tree(data);
      make_tree(data, "#tree-container2");
    });


    $('#export').click(function() {
      var tree1 = $('#tree-container').find('.tree').jstree(true).get_json('#');
      var tree2 = $('#tree-container2').find('.tree').jstree(true).get_json('#');
      var data = [tree1[0], tree2[0]];
      // v = v[0];
      saveData(data, 'tree_export.json');
    });


    $('#import').click(function() {
      // var jsonstring = $('#jsontext').val();
      // var json = JSON.parse(jsonstring);
      // make_tree(json);
      $('#jsonfileinput').click();
    });

    $('#jsonfileinput').change(function(ev){
      console.log(this.files[0]);


      var reader = new FileReader();

      reader.onload = (function(file) {
        var jsontext = reader.result;
        var json = JSON.parse(jsontext);
        make_tree(json[0]);
        make_tree(json[1], '#tree-container2');
      });

      reader.readAsText(this.files[0]);

    });
  });

  </script>

</body>
</html>
